---
- name: Create Vector directories
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: '0755'
  loop:
    - /etc/vector
    - /var/lib/vector

- name: Create Vector configuration file
  ansible.builtin.template:
    src: vector.yaml.j2
    dest: /etc/vector/vector.yaml
    mode: '0644'

- name: Create dummy vector binary
  ansible.builtin.copy:
    dest: /usr/local/bin/vector
    content: |
      #!/bin/bash
      if [ "$1" = "--version" ]; then
        echo "vector 0.37.1 (x86_64-unknown-linux-gnu)"
      elif [ "$1" = "validate" ] && [ "$2" = "--config-yaml" ]; then
        if [ -f "$3" ]; then
          echo "Configuration is valid"
          exit 0
        else
          echo "Configuration file not found: $3"
          exit 1
        fi
      else
        echo "Vector dummy binary for testing"
        exit 0
      fi
    mode: '0755'

- name: Check if Vector is running (simulate service)
  ansible.builtin.shell: |
    echo "Vector would be running on port 8686"
    exit 0
  changed_when: false
